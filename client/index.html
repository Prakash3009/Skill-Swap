<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="SkillSwap - The modern platform for peer-to-peer skill exchange. Connect, learn, and grow.">
  <title>SkillSwap | Learn & Share Skills</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/chatbot.css">
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="container">
      <a href="index.html" class="navbar-brand">
        <img src="img/logo.png" alt="SkillSwap" class="brand-logo">
      </a>
      <ul class="navbar-nav">
        <li><a href="index.html" class="nav-link active">Home</a></li>
        <li><a href="search.html" class="nav-link">Find Mentors</a></li>
        <li><a href="community.html" class="nav-link">Communities</a></li>
        <li><a href="experiences.html" class="nav-link">Experiences</a></li>
        <li><a href="redeem.html" class="nav-link">Redeem</a></li>
        <li><a href="profile.html" class="nav-link">My Profile</a></li>
        <li><a href="requests.html" class="nav-link">My Requests</a></li>
      </ul>
    </div>
  </nav>

  <main>
    <!-- Hero Section -->
    <header class="hero">
      <div class="container">
        <div class="hero-grid">
          <div class="hero-content">
            <h1>Master New Skills Through <span style="color: var(--primary);">Peer Connections</span></h1>
            <p>The most trustworthy community for sharing expertise. Teach what you know, learn what you need, and earn
              rewards for your contributions.</p>
            <div class="hero-actions">
              <a href="profile.html" class="btn btn-primary btn-lg">Get Started Free</a>
              <a href="search.html" class="btn btn-secondary btn-lg">Explore Mentors</a>
            </div>
          </div>
          <div class="hero-image-container">
            <img src="img/hero-image.jpg" alt="SkillSwap Mentorship" class="hero-image">
          </div>
        </div>
      </div>
    </header>

    <!-- Features Section -->
    <section class="features">
      <div class="container">
        <h2 class="section-title">Designed for Better Learning</h2>
        <p class="section-subtitle">SkillSwap provides the tools you need to connect with experts and build your
          knowledge base efficiently.</p>

        <div class="grid grid-3">
          <div class="card feature-card">
            <div class="card-icon">üë§</div>
            <h3>Build Your Profile</h3>
            <p>Showcase your expertise and what you're looking to master. Start your journey with 10 complimentary
              learning coins.</p>
          </div>

          <div class="card feature-card">
            <div class="card-icon">üîç</div>
            <h3>Smart Mentor Search</h3>
            <p>Find the perfect mentor with our advanced filtering by skill and category. Each mentorship request is
              just 1 coin away.</p>
          </div>

          <div class="card feature-card">
            <div class="card-icon">üéì</div>
            <h3>Learn & Earn</h3>
            <p>Complete sessions to gain valuable knowledge. Mentors earn 5 coins for every successful mentorship
              completed.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Account Setup Section -->
    <section style="padding: 6rem 0;">
      <div class="container">
        <div class="grid grid-2" style="align-items: center;">
          <div id="user-setup-context">
            <h2>Join the Community Today</h2>
            <p style="font-size: 1.125rem; margin: 1rem 0 2rem; color: var(--text-body);">Trusted by thousands of
              students and professionals. Create your account in seconds and start learning.</p>
          </div>

          <div class="card" style="box-shadow: var(--shadow-xl);">
            <div id="user-setup">
              <h3>Create Your Account</h3>
              <form id="create-user-form" style="margin-top: 1.5rem;">
                <div class="form-group">
                  <label for="name" class="form-label">Full Name</label>
                  <input type="text" id="name" class="form-control" placeholder="John Doe" required>
                </div>

                <div class="form-group">
                  <label for="email" class="form-label">Work Email</label>
                  <input type="email" id="email" class="form-control" placeholder="john@example.com" required>
                </div>

                <div class="form-group">
                  <label for="bio" class="form-label">Short Bio</label>
                  <textarea id="bio" class="form-control" rows="3"
                    placeholder="I am a software enthusiast interested in..."></textarea>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">Setup Account</button>
              </form>
            </div>

            <div id="user-info" style="display: none;">
              <div
                style="background: var(--primary-light); color: var(--primary); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1.5rem; font-weight: 600;">
                ‚úì Account successfully configured!
              </div>
              <div class="d-flex justify-between align-center">
                <div>
                  <h3 id="user-name" style="margin: 0;"></h3>
                  <p id="user-email" class="text-muted" style="margin: 0;"></p>
                </div>
                <div class="coin-badge">
                  <span id="user-coins">10</span> Coins
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Recommendations Section (Visible only for logged-in users) -->
    <section id="recommendations-section" style="padding: 6rem 0; display: none;">
      <div class="container">
        <div class="d-flex justify-between align-center mb-4">
          <div>
            <h2 class="section-title" style="text-align: left; margin-bottom: 0.5rem;">‚≠ê Recommended Mentors for You
            </h2>
            <p class="text-muted">Personalized suggestions based on your skills, activity, and expertise.</p>
          </div>
          <a href="search.html" class="btn btn-secondary">See All Mentors</a>
        </div>

        <div id="recommendations-container" class="grid grid-3">
          <!-- Recommended mentors will be injected here -->
          <div class="loading-container" style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
            <span class="spinner"></span> Finding the best matches for you...
          </div>
        </div>
      </div>
    </section>

    <!-- Student Startups Section -->
    <section id="startups-section" style="padding: 6rem 0; background-color: var(--bg-tertiary);">
      <div class="container">
        <div class="d-flex justify-between align-center mb-4">
          <div>
            <h2 class="section-title" style="text-align: left; margin-bottom: 0.5rem;">üöÄ Student-Led Startups</h2>
            <p class="text-muted">Innovation by the community. Support these ideas with your coins!</p>
          </div>
          <div class="d-flex gap-2">
            <button id="create-startup-btn" class="btn btn-primary" style="display: none;"
              onclick="window.location.href='startups.html?action=create'">+ Share Startup</button>
            <a href="startups.html" class="btn btn-secondary">Explore All</a>
          </div>
        </div>

        <div id="startups-container" class="grid grid-3">
          <!-- Startup cards will be injected here -->
          <div class="loading-container" style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
            <span class="spinner"></span> Discovering unicorns...
          </div>
        </div>
      </div>
    </section>

    <!-- Leaderboard Section -->
    <section class="leaderboard-section" style="background-color: var(--bg-subtle);">
      <div class="container">
        <h2 class="section-title">Peer Learning Champions</h2>
        <p class="section-subtitle">Recognizing our most dedicated mentors who are helping the community grow every day.
        </p>

        <div class="leaderboard-table-container">
          <div id="leaderboard-container">
            <div style="padding: 4rem; text-align: center;"><span class="spinner"></span> Loading Champions...</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
      <div class="container">
        <div class="stats-grid">
          <div class="stat-item">
            <h3 id="total-users">0</h3>
            <p>Active Learners</p>
          </div>
          <div class="stat-item">
            <h3 id="total-skills">0</h3>
            <p>Skills Offered</p>
          </div>
          <div class="stat-item">
            <h3 id="total-requests">0</h3>
            <p>Mentorships Hosted</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-about">
          <a href="index.html" class="navbar-brand">
            <img src="img/logo.png" alt="SkillSwap" class="brand-logo">
          </a>
          <p>The world's leading peer-to-peer skill exchange platform. Connect, learn, and grow your expertise today.
          </p>
        </div>
        <div>
          <h4 class="footer-heading">Platform</h4>
          <ul class="footer-links">
            <li><a href="search.html" class="footer-link">Find Mentors</a></li>
            <li><a href="community.html" class="footer-link">Communities</a></li>
            <li><a href="redeem.html" class="footer-link">Rewards</a></li>
          </ul>
        </div>
        <div>
          <h4 class="footer-heading">Account</h4>
          <ul class="footer-links">
            <li><a href="profile.html" class="footer-link">View Profile</a></li>
            <li><a href="requests.html" class="footer-link">My Requests</a></li>
          </ul>
        </div>
        <div>
          <h4 class="footer-heading">Connect With Us</h4>
          <div class="footer-social">
            <a href="https://linkedin.com/in/abhilash-tech" target="_blank" class="social-icon" title="LinkedIn">in</a>
            <a href="https://github.com/Abhilash-18-tech" target="_blank" class="social-icon" title="GitHub">gh</a>
            <a href="#" class="social-icon" title="Twitter">tw</a>
            <a href="#" class="social-icon" title="Instagram">ig</a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>¬© 2026 SkillSwap Hackathon. Built with ‚ú® by CODE-CRAFTERS</p>
        <div class="d-flex gap-2">
          <span>Privacy Policy</span>
          <span>Terms of Service</span>
        </div>
      </div>
    </div>
  </footer>

  <!-- JavaScript -->
  <script src="js/main.js"></script>
  <script src="js/chatbot.js"></script>
  <script>
    const API_URL = '/api';

    document.addEventListener('DOMContentLoaded', async () => {
      await loadStats();
      await loadLeaderboard();
      await loadHomeStartups();
      checkExistingUser();
    });

    async function loadHomeStartups() {
      const container = document.getElementById('startups-container');
      try {
        const response = await fetch(`${API_URL}/startups?limit=3`);
        const result = await response.json();

        if (result.success && result.data.length > 0) {
          container.innerHTML = result.data.map(startup => `
            <div class="card mentor-card" onclick="window.location.href='startups.html?id=${startup._id}'">
              <div class="d-flex justify-between align-center mb-2">
                <span class="badge badge-primary">Startup</span>
                <span class="text-muted" style="font-size: 0.8rem;">${timeAgo(startup.createdAt)}</span>
              </div>
              <h3 class="mb-2">${startup.name}</h3>
              <p class="text-muted" style="font-size: 0.9rem; line-height: 1.5; margin-bottom: 1rem; height: 2.8rem; overflow: hidden;">${startup.ideaOrProblem}</p>
              
              <div class="d-flex justify-between align-center mt-auto pt-3" style="border-top: 1px solid var(--border-subtle);">
                <div style="color: #f59e0b; font-weight: 600;">‚≠ê ${startup.averageRating.toFixed(1)}</div>
                <div style="font-weight: 600;">ü™ô ${startup.totalSponsoredCoins}</div>
              </div>
            </div>
          `).join('');
        } else {
          container.innerHTML = '<p class="text-muted" style="grid-column: 1 / -1; text-align: center;">No startups registered yet. Be the first to innovate!</p>';
        }
      } catch (error) {
        console.error('Error loading startups:', error);
        container.innerHTML = '<p class="text-danger">Failed to load startups.</p>';
      }
    }

    let championsData = [];

    async function loadLeaderboard() {
      const container = document.getElementById('leaderboard-container');
      try {
        const response = await fetch(`${API_URL}/users/leaderboard`);
        const result = await response.json();

        if (result.success) {
          championsData = result.data;

          if (championsData.length === 0) {
            container.innerHTML = '<div style="padding: 3rem; text-align: center;" class="text-muted">No champions found yet. Start rating mentors to see them here!</div>';
            return;
          }

          container.innerHTML = `
            <div class="grid grid-3" style="gap: 2rem;">
              ${championsData.map((user, index) => {
            const rankColors = ['#FFD700', '#C0C0C0', '#CD7F32']; // Gold, Silver, Bronze
            return `
                  <div class="card champion-card" onclick="openChampionModal(${index})" style="position: relative; cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease; text-align: center; border: 2px solid ${index < 3 ? rankColors[index] : 'transparent'};">
                    <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); background: ${rankColors[index] || '#4f46e5'}; color: #fff; padding: 0.25rem 1rem; border-radius: 20px; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                      #${index + 1} Champion
                    </div>
                    <div style="font-size: 3rem; margin: 1.5rem 0 0.5rem;">üëë</div>
                    <h3 style="margin-bottom: 0.5rem;">${user.name}</h3>
                    <div style="color: #f59e0b; font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem;">
                      ‚≠ê ${user.averageRating.toFixed(1)} <span style="font-size: 0.9rem; color: #6b7280; font-weight: 400;">(${user.totalRatingsCount} reviews)</span>
                    </div>
                    <p class="text-muted" style="font-size: 0.9rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 2.8em;">${user.bio || 'Top rated mentor.'}</p>
                    <button class="btn btn-primary btn-sm mt-3" style="width: 100%;">View Profile</button>
                  </div>
                `;
          }).join('')}
            </div>
          `;
        }
      } catch (error) {
        console.error('Error loading leaderboard:', error);
        container.innerHTML = '<div style="padding: 3rem; text-align: center;" class="text-danger">Failed to load champions.</div>';
      }
    }

    function openChampionModal(index) {
      const user = championsData[index];
      const modal = document.createElement('div');
      modal.id = 'champion-modal';
      modal.style.cssText = `
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); z-index: 10000;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; animation: fadeIn 0.3s forwards;
        `;

      modal.innerHTML = `
            <div class="card" style="max-width: 500px; width: 90%; position: relative; max-height: 90vh; overflow-y: auto;">
                <button onclick="document.getElementById('champion-modal').remove()" style="position: absolute; top: 1rem; right: 1rem; border: none; background: none; font-size: 1.5rem; cursor: pointer;">‚úï</button>
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 4rem;">üëë</div>
                    <h2 class="mb-2">${user.name}</h2>
                    <div class="badge badge-primary" style="font-size: 1rem;">${user.coins} Experience Coins</div>
                </div>
                
                <div class="grid grid-2 mb-3" style="text-align: center; background: var(--bg-subtle); padding: 1rem; border-radius: var(--radius-md);">
                    <div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #f59e0b;">${user.averageRating.toFixed(1)} ‚≠ê</div>
                        <div class="text-muted">Avg Rating</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: bold;">${user.totalRatingsCount}</div>
                        <div class="text-muted">Total Reviews</div>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="form-label">About Mentor</label>
                    <p style="line-height: 1.6;">${user.bio || 'No bio provided.'}</p>
                </div>

                <div>
                    <a href="mailto:${user.email}" class="btn btn-primary w-100">Contact Mentor</a>
                </div>
            </div>
        `;

      document.body.appendChild(modal);

      // Close on click outside
      modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.remove();
      });
    }

    // Add fadeIn animation
    const styleSheet = document.createElement("style");
    styleSheet.innerText = `
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
      .champion-card:hover { transform: translateY(-10px) !important; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
    `;
    document.head.appendChild(styleSheet);

    function checkExistingUser() {
      const userId = localStorage.getItem('userId');
      if (userId) {
        document.getElementById('user-setup').style.display = 'none';
        document.getElementById('user-info').style.display = 'block';
        if (document.getElementById('create-startup-btn')) {
          document.getElementById('create-startup-btn').style.display = 'block';
        }
        loadUserInfo(userId);
      }
    }

    async function loadUserInfo(userId) {
      try {
        const response = await fetch(`${API_URL}/users/${userId}`);
        const result = await response.json();
        if (result.success) {
          const user = result.data;
          document.getElementById('user-name').textContent = user.name;
          document.getElementById('user-email').textContent = user.email;
          document.getElementById('user-coins').textContent = user.coins;

          // Load recommendations if user is authenticated
          document.getElementById('recommendations-section').style.display = 'block';
          loadRecommendations(userId);
        }
      } catch (error) {
        console.error('Error loading user:', error);
      }
    }

    async function loadRecommendations(userId) {
      const container = document.getElementById('recommendations-container');
      try {
        const response = await fetch(`${API_URL}/users/recommendations/${userId}`);
        const result = await response.json();

        if (result.success && result.data.length > 0) {
          container.innerHTML = result.data.map(mentor => `
            <div class="card mentor-card" onclick="window.location.href='mentor.html?id=${mentor._id}'">
              <div class="d-flex justify-between align-center mb-3">
                <div class="badge badge-success">Match: ${mentor.recommendationScore}%</div>
                <div class="coin-badge" style="font-size: 0.8rem; padding: 0.2rem 0.5rem;">${mentor.coins} ü™ô</div>
              </div>
              <h3 class="mb-1">${mentor.name}</h3>
              <div style="color: #f59e0b; margin-bottom: 1rem;">
                ${'‚≠ê'.repeat(Math.round(mentor.avgRating)) || 'No ratings yet'}
              </div>
              <div class="mb-3 d-flex flex-wrap gap-1">
                ${mentor.skills.slice(0, 3).map(skill => `<span class="badge badge-primary">${skill}</span>`).join('')}
                ${mentor.skills.length > 3 ? `<span class="text-muted" style="font-size: 0.8rem;">+${mentor.skills.length - 3} more</span>` : ''}
              </div>
              <p class="text-muted" style="font-size: 0.9rem; line-height: 1.5; height: 3rem; overflow: hidden;">${mentor.bio || 'Experienced mentor ready to help you grow.'}</p>
              <div class="mt-3 pt-3" style="border-top: 1px solid var(--border-subtle); font-size: 0.8rem; color: var(--text-muted); font-style: italic;">
                Recommended based on your interest match and their expertise.
              </div>
            </div>
          `).join('');
        } else {
          container.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; background: var(--bg-subtle); border-radius: var(--radius-md);">
              <p>Add some skills to your profile to get personalized recommendations!</p>
              <a href="profile.html" class="btn btn-sm btn-primary mt-2">Update Skills</a>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error loading recommendations:', error);
        container.innerHTML = '<p class="text-danger">Failed to load recommendations.</p>';
      }
    }

    async function loadStats() {
      try {
        const [usersRes, skillsRes] = await Promise.all([
          fetch(`${API_URL}/users`),
          fetch(`${API_URL}/skills/search?skillName=`)
        ]);
        const users = await usersRes.json();
        const skills = await skillsRes.json();
        if (users.success) document.getElementById('total-users').textContent = users.count || 0;
        if (skills.success) document.getElementById('total-skills').textContent = skills.count || 0;
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }

    document.getElementById('create-user-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const bio = document.getElementById('bio').value;

      try {
        const response = await fetch(`${API_URL}/users`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, bio })
        });
        const result = await response.json();
        if (result.success) {
          localStorage.setItem('userId', result.data._id);
          showAlert('Account created! Welcome to SkillSwap.', 'success');
          document.getElementById('user-setup').style.display = 'none';
          document.getElementById('user-info').style.display = 'block';
          document.getElementById('user-name').textContent = result.data.name;
          document.getElementById('user-email').textContent = result.data.email;
          document.getElementById('user-coins').textContent = result.data.coins;

          // Show recommendations section
          document.getElementById('recommendations-section').style.display = 'block';
          loadRecommendations(result.data._id);

          await loadStats();
          await loadLeaderboard();
        } else {
          showAlert(result.message, 'danger');
        }
      } catch (error) {
        console.error('Error creating user:', error);
        showAlert('Setup failed. Please try again.', 'danger');
      }
    });
  </script>
</body>

</html>